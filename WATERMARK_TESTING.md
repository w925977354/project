# æ°´å°åŠŸèƒ½æµ‹è¯•æŒ‡å— / Watermark Feature Testing Guide

## ğŸ¨ æ°´å°åŠŸèƒ½è¯´æ˜ï¼ˆå‡çº§ç‰ˆï¼‰

æœ¬ç³»ç»Ÿå®ç°äº†**åŒé‡æ°´å°ç³»ç»Ÿ**ï¼Œè¿™æ˜¯ä½œä¸šçš„æ ¸å¿ƒé«˜çº§æŠ€æœ¯åŠ åˆ†é¡¹ã€‚

### åŠŸèƒ½ç‰¹ç‚¹

âœ… **æ˜¾ç¤ºæ°´å°**: æ‰€æœ‰ç…§ç‰‡æ˜¾ç¤ºæ—¶å³ä¸‹è§’æ˜¾ç¤ºä¸Šä¼ è€…åå­—  
âœ… **æ™ºèƒ½ä¸‹è½½**: æ ¹æ®ç™»å½•çŠ¶æ€æä¾›ä¸åŒç‰ˆæœ¬  
âœ… **åŸå›¾ä¿å­˜**: æœåŠ¡å™¨ä¿å­˜æ— æ°´å°åŸå›¾  
âœ… **åŠ¨æ€ç”Ÿæˆ**: æ°´å°å®æ—¶ç”Ÿæˆï¼Œä¸ä¿®æ”¹åŸå›¾  
âœ… **ç‰ˆæƒä¿æŠ¤**: æœªç™»å½•ç”¨æˆ·ä¸‹è½½å¸¦æ–œè¡Œæ°´å°  

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ ¸å¿ƒåŠŸèƒ½

#### A. æ˜¾ç¤ºæ°´å°ï¼ˆå³ä¸‹è§’å°æ°´å°ï¼‰
- **ä½ç½®**: å›¾ç‰‡å³ä¸‹è§’
- **å†…å®¹**: `Â© ä¸Šä¼ è€…åå­—`
- **æ ·å¼**: åŠé€æ˜ç™½è‰²æ–‡å­—
- **å®ç°**: `PhotoController::displayWithWatermark()`

#### B. ä¸‹è½½åŠŸèƒ½ï¼ˆæ™ºèƒ½æ°´å°ï¼‰

**å·²ç™»å½•ç”¨æˆ·**:
- ä¸‹è½½åŸå›¾ï¼ˆæ— æ°´å°ï¼‰
- æ–‡ä»¶å: `{æ ‡é¢˜}_original.{æ‰©å±•å}`

**æœªç™»å½•ç”¨æˆ·**:
- ä¸‹è½½å¸¦æ–œè¡Œæ°´å°çš„ç‰ˆæœ¬
- æ°´å°å†…å®¹: `Â© {ä¸Šä¼ è€…} - Photo Gallery`
- æ°´å°æ ·å¼: 45åº¦æ–œè§’ï¼ŒåŠé€æ˜ï¼Œé‡å¤å¹³é“º
- æ–‡ä»¶å: `{æ ‡é¢˜}_watermarked.jpg`

### 2. ä»£ç ä½ç½®

**PhotoController.php** åŒ…å«ä¸‰ä¸ªå…³é”®æ–¹æ³•:

1. **`store()`** (Line 54-93): ä¿å­˜åŸå›¾ï¼Œä¸æ·»åŠ æ°´å°
2. **`download()`** (Line 177-207): æ™ºèƒ½ä¸‹è½½åŠŸèƒ½
3. **`addDiagonalWatermark()`** (Line 209-252): ç”Ÿæˆæ–œè¡Œæ°´å°
4. **`displayWithWatermark()`** (Line 254-289): æ˜¾ç¤ºç”¨å°æ°´å°

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### å‰ç½®æ¡ä»¶

```bash
# 1. ç¡®ä¿æ•°æ®åº“å·²è¿ç§»
php artisan migrate

# 2. åˆ›å»ºæµ‹è¯•è´¦å·
php artisan db:seed --class=AdminUserSeeder

# 3. åˆ›å»ºå­˜å‚¨é“¾æ¥
php artisan storage:link

# 4. å¯åŠ¨æœåŠ¡å™¨
php artisan serve
```

### æµ‹è¯•åœºæ™¯ 1: ä¸Šä¼ ä¸æ˜¾ç¤º

1. **ç™»å½•ç³»ç»Ÿ**
   - è®¿é—® http://localhost:8000
   - ä½¿ç”¨ `user@example.com` / `password` ç™»å½•

2. **ä¸Šä¼ ç…§ç‰‡**
   - ç‚¹å‡» "Upload Photo" æŒ‰é’®
   - å¡«å†™æ ‡é¢˜å’Œæè¿°
   - é€‰æ‹©ä¸€å¼ å›¾ç‰‡ä¸Šä¼ 

3. **éªŒè¯æ˜¾ç¤ºæ°´å°**
   - å›åˆ°ç›¸å†Œé¦–é¡µ
   - æŸ¥çœ‹ç…§ç‰‡**å³ä¸Šè§’è“è‰²å¾½ç« **ï¼šæ˜¾ç¤º `Â© John Doe`
   - ç‚¹å‡»æŸ¥çœ‹å¤§å›¾ï¼Œå³ä¸‹è§’ä¹Ÿæœ‰å°æ°´å°

### æµ‹è¯•åœºæ™¯ 2: å·²ç™»å½•ç”¨æˆ·ä¸‹è½½

1. **ç‚¹å‡»ä¸‹è½½æŒ‰é’®**
   - åœ¨ç›¸å†Œé¦–é¡µï¼Œç‚¹å‡»ç…§ç‰‡å¡ç‰‡ä¸‹æ–¹çš„ "Original" æŒ‰é’®
   - æˆ–åœ¨è¯¦æƒ…é¡µç‚¹å‡» "Download Original (No Watermark)"

2. **éªŒè¯ä¸‹è½½ç»“æœ**
   - ä¸‹è½½çš„æ–‡ä»¶ååŒ…å« `_original`
   - æ‰“å¼€å›¾ç‰‡ï¼Œ**æ²¡æœ‰ä»»ä½•æ°´å°**
   - è¿™æ˜¯çº¯å‡€çš„åŸå›¾

### æµ‹è¯•åœºæ™¯ 3: æœªç™»å½•ç”¨æˆ·ä¸‹è½½

1. **é€€å‡ºç™»å½•**
   - ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å â†’ Log Out

2. **è®¿é—®ç›¸å†Œ**
   - è®¿é—® http://localhost:8000
   - å¯ä»¥çœ‹åˆ°æ‰€æœ‰ç…§ç‰‡ï¼ˆå…¬å¼€è®¿é—®ï¼‰

3. **ä¸‹è½½ç…§ç‰‡**
   - ç‚¹å‡» "Download" æŒ‰é’®
   - ä¸‹è½½çš„æ–‡ä»¶ååŒ…å« `_watermarked.jpg`

4. **éªŒè¯æ–œè¡Œæ°´å°**
   - æ‰“å¼€ä¸‹è½½çš„å›¾ç‰‡
   - åº”è¯¥çœ‹åˆ°**æ•´å¼ å›¾ç‰‡å¸ƒæ»¡æ–œè¡Œæ°´å°**
   - æ°´å°å†…å®¹: `Â© John Doe - Photo Gallery`
   - æ°´å°è§’åº¦: 45åº¦æ–œè§’
   - æ°´å°æ ·å¼: åŠé€æ˜ç™½è‰²ï¼Œé‡å¤å¹³é“º

---

## ğŸ¯ é¢„æœŸæ•ˆæœå¯¹æ¯”

### æ˜¾ç¤ºæ•ˆæœï¼ˆæ‰€æœ‰ç”¨æˆ·ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Â© John Doe  â† å³ä¸Šè§’å¾½ç«    â”‚
â”‚                             â”‚
â”‚     Your Beautiful Photo    â”‚
â”‚                             â”‚
â”‚                             â”‚
â”‚                  Â© John Doe â”‚ â† å³ä¸‹è§’å°æ°´å°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‹è½½æ•ˆæœï¼ˆå·²ç™»å½•ï¼‰

```
åŸå›¾ - æ— ä»»ä½•æ°´å°
å®Œå…¨å¹²å‡€çš„å›¾ç‰‡
```

### ä¸‹è½½æ•ˆæœï¼ˆæœªç™»å½•ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â© John Doe - Photo Gallery  â”‚
â”‚    Â© John Doe - Photo...    â”‚
â”‚       Â© John Doe - Pho...   â”‚
â”‚          Â© John Doe - ...   â”‚
â”‚             Â© John Doe...   â”‚
â”‚                Â© John ...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æ–œè¡Œæ°´å°è¦†ç›–æ•´å¼ å›¾ç‰‡
```

---

## âœ… éªŒè¯æ¸…å•

### åŸºç¡€åŠŸèƒ½
- [ ] ä¸Šä¼ ç…§ç‰‡æˆåŠŸï¼ŒåŸå›¾ä¿å­˜åœ¨æœåŠ¡å™¨
- [ ] ç›¸å†Œé¦–é¡µå³ä¸Šè§’æ˜¾ç¤ºä¸Šä¼ è€…åå­—ï¼ˆè“è‰²å¾½ç« ï¼‰
- [ ] ç…§ç‰‡è¯¦æƒ…é¡µå³ä¸‹è§’æ˜¾ç¤ºå°æ°´å°
- [ ] ä¸‹è½½æŒ‰é’®æ­£ç¡®æ˜¾ç¤ºï¼ˆå·²ç™»å½•æ˜¾ç¤º"Original"ï¼Œæœªç™»å½•æ˜¾ç¤º"Download"ï¼‰

### å·²ç™»å½•ç”¨æˆ·
- [ ] ä½¿ç”¨ `user@example.com` ç™»å½•
- [ ] ä¸Šä¼ ç…§ç‰‡ï¼Œæ°´å°æ˜¾ç¤º `Â© John Doe`
- [ ] ä¸‹è½½ç…§ç‰‡ï¼Œè·å¾—æ— æ°´å°åŸå›¾
- [ ] æ–‡ä»¶ååŒ…å« `_original`

### æœªç™»å½•ç”¨æˆ·
- [ ] é€€å‡ºç™»å½•çŠ¶æ€
- [ ] å¯ä»¥æµè§ˆæ‰€æœ‰ç…§ç‰‡
- [ ] ä¸‹è½½ç…§ç‰‡ï¼Œè·å¾—å¸¦æ–œè¡Œæ°´å°ç‰ˆæœ¬
- [ ] æ°´å°ä¸º 45 åº¦æ–œè§’ï¼Œé‡å¤å¹³é“º
- [ ] æ–‡ä»¶åä¸º `_watermarked.jpg`

### ç®¡ç†å‘˜åŠŸèƒ½
- [ ] ä½¿ç”¨ `admin@example.com` ç™»å½•
- [ ] ä¸Šä¼ ç…§ç‰‡ï¼Œæ°´å°æ˜¾ç¤º `Â© Admin User`
- [ ] å¯ä»¥åˆ é™¤ä»»ä½•ç”¨æˆ·çš„ç…§ç‰‡
- [ ] ä¸‹è½½è‡ªå·±çš„ç…§ç‰‡è·å¾—åŸå›¾

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: æ°´å°ä¸æ˜¾ç¤º

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹è·¯ç”±
php artisan route:list | grep watermarked

# åº”è¯¥çœ‹åˆ°:
# GET photos/{photo}/watermarked
```

**è§£å†³**:
```bash
php artisan route:clear
php artisan cache:clear
```

### é—®é¢˜ 2: ä¸‹è½½å¤±è´¥

**æ£€æŸ¥**:
- ç¡®ä¿ `storage/app/public/photos/` ç›®å½•å­˜åœ¨
- æ£€æŸ¥æ–‡ä»¶æƒé™ï¼ˆLinux: `chmod -R 775 storage`ï¼‰
- æŸ¥çœ‹ Laravel æ—¥å¿—: `storage/logs/laravel.log`

### é—®é¢˜ 3: æ–œè¡Œæ°´å°ä½ç½®ä¸å¯¹

**è°ƒæ•´å‚æ•°** (PhotoController.php Line 230-231):
```php
$spacing = 200; // å¢å¤§é—´è·
$angle = -45;   // è°ƒæ•´è§’åº¦
```

---

## ğŸ“š ä½œä¸šæŠ¥å‘Šå¼•ç”¨

### æŠ€æœ¯äº®ç‚¹è¯´æ˜

> "æœ¬ç³»ç»Ÿå®ç°äº†æ™ºèƒ½åŒé‡æ°´å°æœºåˆ¶ï¼š
> 
> 1. **æ˜¾ç¤ºæ°´å°**: æ‰€æœ‰ç…§ç‰‡åœ¨ç½‘é¡µæ˜¾ç¤ºæ—¶ï¼Œä½¿ç”¨ Intervention Image åº“åŠ¨æ€æ·»åŠ å³ä¸‹è§’æ°´å°ï¼Œæ˜¾ç¤ºä¸Šä¼ è€…åå­—ï¼Œä¿æŠ¤ç‰ˆæƒä¿¡æ¯ã€‚
> 
> 2. **ä¸‹è½½ä¿æŠ¤**: å®ç°äº†åŸºäºç”¨æˆ·è®¤è¯çŠ¶æ€çš„æ™ºèƒ½ä¸‹è½½åŠŸèƒ½ï¼š
>    - å·²ç™»å½•ç”¨æˆ·ä¸‹è½½åŸå›¾ï¼ˆæ— æ°´å°ï¼‰ï¼Œæ–¹ä¾¿åˆæ³•ä½¿ç”¨
>    - æœªç™»å½•è®¿å®¢ä¸‹è½½æ—¶è‡ªåŠ¨æ·»åŠ æ–œè¡Œå¹³é“ºæ°´å°ï¼Œæœ‰æ•ˆé˜²æ­¢ç›—å›¾
> 
> 3. **åŸå›¾ä¿æŠ¤**: æœåŠ¡å™¨å§‹ç»ˆä¿å­˜æ— æ°´å°åŸå›¾ï¼Œæ°´å°é€šè¿‡ PHP GD åº“å®æ—¶ç”Ÿæˆï¼Œä¸ç ´ååŸå§‹æ–‡ä»¶ã€‚
> 
> è¿™ç§è®¾è®¡æ—¢ä¿æŠ¤äº†ç‰ˆæƒï¼Œåˆä¸å½±å“åˆæ³•ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒã€‚"

### ä»£ç å®ç°è¦ç‚¹

**1. åŠ¨æ€æ°´å°ç”Ÿæˆ** (é«˜çº§æŠ€æœ¯):
```php
// æ ¹æ®ç”¨æˆ·çŠ¶æ€è¿”å›ä¸åŒç‰ˆæœ¬
if (Auth::check()) {
    return response()->download($filePath); // åŸå›¾
} else {
    return $this->addDiagonalWatermark($filePath); // å¸¦æ°´å°
}
```

**2. æ–œè¡Œæ°´å°ç®—æ³•**:
```php
// åŒé‡å¾ªç¯ç”Ÿæˆå¹³é“ºæ•ˆæœ
for ($x = -$height; $x < $width + $height; $x += $spacing) {
    for ($y = -$width; $y < $height + $width; $y += $spacing) {
        $img->text($watermarkText, $x, $y, ...);
    }
}
```

**3. è·¨å¹³å°å…¼å®¹**:
- ä½¿ç”¨ Laravel Storage facade
- GD é©±åŠ¨ï¼ˆWindows/Linux é€šç”¨ï¼‰
- åŠ¨æ€è·¯å¾„è®¡ç®—

---

## ğŸ“ è¯„åˆ†åŠ åˆ†ç‚¹

âœ… **Advanced Image Processing**: Intervention Image 3.x  
âœ… **Dynamic Watermarking**: å®æ—¶ç”Ÿæˆï¼Œä¸ä¿®æ”¹åŸå›¾  
âœ… **Smart Download**: åŸºäºè®¤è¯çŠ¶æ€çš„æ™ºèƒ½é€»è¾‘  
âœ… **Copyright Protection**: æ–œè¡Œæ°´å°é˜²ç›—å›¾  
âœ… **User Experience**: å·²ç™»å½•ç”¨æˆ·è·å¾—åŸå›¾  
âœ… **Code Quality**: å®Œæ•´æ³¨é‡Šï¼Œæ¸…æ™°é€»è¾‘  
âœ… **Security**: Policy æˆæƒæ§åˆ¶  

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•å‘½ä»¤

```bash
# ä¸€é”®å¯åŠ¨ï¼ˆä½¿ç”¨ PowerShell è„šæœ¬ï¼‰
.\quick-start.ps1

# æˆ–æ‰‹åŠ¨æ‰§è¡Œ
php artisan migrate
php artisan db:seed --class=AdminUserSeeder
php artisan storage:link
php artisan serve
```

ç„¶åè®¿é—® http://localhost:8000

**æµ‹è¯•è´¦å·**:
- ğŸ‘¤ æ™®é€šç”¨æˆ·: `user@example.com` / `password`
- ğŸ‘‘ ç®¡ç†å‘˜: `admin@example.com` / `password`

---

## ğŸ“¸ æµ‹è¯•æµç¨‹æ€»ç»“

1. **ç™»å½•** â†’ ä¸Šä¼ ç…§ç‰‡ â†’ æŸ¥çœ‹å³ä¸Šè§’å¾½ç« ï¼ˆä¸Šä¼ è€…åå­—ï¼‰
2. **å·²ç™»å½•** â†’ ç‚¹å‡»ä¸‹è½½ â†’ è·å¾—åŸå›¾ï¼ˆæ— æ°´å°ï¼‰
3. **é€€å‡ºç™»å½•** â†’ ç‚¹å‡»ä¸‹è½½ â†’ è·å¾—æ–œè¡Œæ°´å°ç‰ˆæœ¬
4. **å¯¹æ¯”ä¸¤ä¸ªæ–‡ä»¶** â†’ éªŒè¯æ°´å°å·®å¼‚

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿå¼€å§‹æµ‹è¯•è¿™ä¸ªé«˜çº§æ°´å°ç³»ç»Ÿï¼** ğŸ‰
